---
# docker-compose.yml
# 
# Docker for Developers - ShipIt Clicker - Chapter 6 docker-compose.yml
#
# Inspired partially by samples in https://github.com/docker-library/redis/issues/111
# Thank you @lagden for providing a nice example of a docker-compose.yml
# file that supports Redis.
version: '3'
services:
  web:
    build: .
    environment:
        # Allow override of Redis host settings - for easier debugging
        # and to pave the way for easy connection to cloud Redis services
        - REDIS_HOST=${REDIS_HOST:-:redis}
        - REDIS_PORT=${REDIS_PORT:-:6379}
    ports:
      - "3000:3000"
    # Connect the web server to Redis via a private network
    networks:
      - private-redis-shipit-clicker
    links:
      - redis
    depends-on:
      - redis

  redis:
    # Start Redis with the command line parameters for persistence
    command: ["redis-server", "--appendonly", "yes"]
    # Use Redis built on on Alpine Linux - it is smaller
    image: redis:5-alpine3.10
    # Ensure Redis uses a persistent data volume
    volumes:
      - redis-data-shipit-clicker:/data
    networks:
      - private-redis-shipit-clicker
    links:


volumes:
  redis-data-shipit-clicker: {}

networks:
  private-redis-shipit-clicker:
